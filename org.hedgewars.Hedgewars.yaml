app-id: org.hedgewars.Hedgewars
runtime: org.kde.Platform
runtime-version: '5.14'
sdk: org.kde.Sdk
command: hedgewars
rename-desktop-file: hedgewars.desktop
rename-icon: hedgewars
rename-appdata-file: hedgewars.appdata.xml
finish-args:
  - --socket=x11
  - --share=ipc
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
  - --share=network
  - --persist=.hedgewars
cleanup:
  - '*.a'
  - '*.la'
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/doc
  - /share/man
modules:
  - name: numa
    only-arches:
      - aarch64
    sources:
      - type: archive
        url: https://github.com/numactl/numactl/releases/download/v2.0.13/numactl-2.0.13.tar.gz
        sha256: 991e254b867eb5951a44d2ae0bf1996a8ef0209e026911ef6c3ef4caf6f58c9a
    cleanup:
      - /bin

  - name: haskell
    buildsystem: simple
    sources:
      - type: archive
        url: https://downloads.haskell.org/~ghc/8.8.3/ghc-8.8.3-x86_64-deb9-linux.tar.xz
        sha256: 42fde2ef5a143e1e6b47ae8875162ea2d4d54b06f0f7fa32ee4f0eb86f2be7ad
        only-arches:
          - x86_64
      - type: archive
        url: https://downloads.haskell.org/~ghc/8.8.3/ghc-8.8.3-i386-deb9-linux.tar.xz
        sha256: 441e2c7a4fc83ebf179712bd939b555cda7c6633545b7c8ac38049f9d85003ae
        only-arches:
          - i386
      - type: archive
        url: https://downloads.haskell.org/~ghc/8.8.3/ghc-8.8.3-aarch64-deb9-linux.tar.xz
        sha256: 2a6821d0e7326cfa7670851702924bbab3b092415ba41247c37419158327eed9
        only-arches:
          - aarch64
    build-commands:
      - install -d /app/lib
      - ln -s /usr/lib/*-linux-gnu/libtinfo.so.6 /app/lib/libtinfo.so.5
      - ./configure --prefix=/app
      -  make install
    cleanup:
      - '*'

  - name: haskell-zlib
    buildsystem: simple
    sources:
      - type: archive
        url: https://hackage.haskell.org/package/zlib-0.6.2.1/zlib-0.6.2.1.tar.gz
        sha256: f0f810ff173560b60392db448455c0513b3239f48e43cb494b3733aa559621d0
    build-commands:
      - ghc-pkg check
      - runhaskell Setup configure --prefix=/app
      - strace -f runhaskell Setup build
      - runhaskell Setup install
    cleanup:
      - '*'

  - name: haskell-random
    buildsystem: simple
    sources:
      - type: archive
        url: https://hackage.haskell.org/package/random-1.1/random-1.1.tar.gz
        sha256: b718a41057e25a3a71df693ab0fe2263d492e759679b3c2fea6ea33b171d3a5a
    build-commands:
      - runhaskell Setup configure --prefix=/app
      - runhaskell Setup build
      - runhaskell Setup install
    cleanup:
      - '*'

  - name: haskell-regex-base
    buildsystem: simple
    sources:
      - type: archive
        url: https://hackage.haskell.org/package/regex-base-0.94.0.0/regex-base-0.94.0.0.tar.gz
        sha256: c41f82f5fc1157c961a4cbdc0cd5561e5aa44f339ce6e706d978d97e0ca6b914
    build-commands:
      - runhaskell Setup configure --prefix=/app
      - runhaskell Setup build
      - runhaskell Setup install
    cleanup:
      - '*'

  - name: haskell-regex-tdfa
    buildsystem: simple
    sources:
      - type: archive
        url: https://hackage.haskell.org/package/regex-tdfa-1.3.1.0/regex-tdfa-1.3.1.0.tar.gz
        sha256: 15c376783d397b3b9933cf35980808feddde273bd6f2445babbccb2f76a42ec0
      - type: shell
        commands:
          - echo -e "import Distribution.Simple\nmain = defaultMain" > Setup.hs
    build-commands:
      - runhaskell Setup configure --prefix=/app
      - runhaskell Setup build
      - runhaskell Setup install
    cleanup:
      - '*'
